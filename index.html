<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Ordering Exercise</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .container {
            margin-top: 30px;
        }
        .sentence-container {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .sentence {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px 15px;
            margin: 8px 0;
            cursor: grab;
            transition: all 0.2s;
        }
        .sentence:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .sentence.dragging {
            opacity: 0.5;
        }
        .sentence.correct {
            border-left: 4px solid #2ecc71;
        }
        .sentence.incorrect {
            border-left: 4px solid #e74c3c;
        }
        .locked .sentence {
            cursor: not-allowed;
            opacity: 0.9;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin: 0 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        #check-btn {
            background-color: #2ecc71;
        }
        #check-btn:hover {
            background-color: #27ae60;
        }
        #check-btn:disabled {
            background-color: #95a5a6;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .correct-result {
            background-color: #d4edda;
            color: #155724;
        }
        .partial-result {
            background-color: #fff3cd;
            color: #856404;
        }
        .incorrect-result {
            background-color: #f8d7da;
            color: #721c24;
        }
        .examples-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .example-btn {
            margin: 0 5px 10px;
            background-color: #f39c12;
        }
        .example-btn:hover {
            background-color: #d35400;
        }
        .example-btn.active {
            background-color: #d35400;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .score-display {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-top: 15px;
        }
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 20px;
            background-color: #3498db;
            text-align: center;
            line-height: 20px;
            color: white;
            transition: width 0.5s;
        }
        .instructions {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        .attempt-info {
            text-align: center;
            margin-top: 15px;
            font-style: italic;
            color: #7f8c8d;
        }
        .current-example {
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 18px;
        }
        /* Student Entry Form Styles */
        .student-entry-container {
            max-width: 400px;
            margin: 0 auto;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .student-form {
            display: flex;
            flex-direction: column;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        #start-btn {
            background-color: #2ecc71;
            width: 100%;
        }
        #start-btn:hover {
            background-color: #27ae60;
        }
        .user-info {
            text-align: right;
            margin-bottom: 10px;
        }
        .user-details {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }
        .student-info span {
            font-weight: bold;
        }
        .timer-container {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin: 15px 0;
            color: #2c3e50;
        }
        .timer-warning {
            color: #e74c3c;
        }
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 100%;
        }
        .modal h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .hidden {
            display: none !important;
        }
        #next-btn {
            background-color: #9b59b6;
        }
        #next-btn:hover {
            background-color: #8e44ad;
        }
        #next-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        .summary-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
    }
    
    .summary-table th,
    .summary-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    
    .summary-table th {
        background-color: #f2f2f2;
    }
    
    .summary-table .total-row {
        font-weight: bold;
        background-color: #e8f4f8;
    }
    
    .example-btn.completed {
        background-color: #2ecc71;
    }
    
    .example-btn.completed:hover {
        background-color: #27ae60;
    }
    </style>
</head>
<body>
    <!-- Student Information Entry View -->
    <div id="student-entry-view">
        <h1>Sentence Ordering Exercise</h1>
        
        <div class="student-entry-container">
            <h2>Student Information</h2>
            <form class="student-form" id="student-form">
                <div class="form-group">
                    <label for="student-name">Full Name</label>
                    <input type="text" id="student-name" required>
                </div>
                <div class="form-group">
                    <label for="roll-number">Roll Number</label>
                    <input type="text" id="roll-number" required>
                </div>
                <div class="form-group">
                    <label for="department">Department</label>
                    <input type="text" id="department" required>
                </div>
                <button type="submit" id="start-btn">Start Game</button>
            </form>
        </div>
    </div>
    
    <!-- Main Application View (hidden initially) -->
    <div id="app-view" class="hidden">
        <h1>Sentence Ordering Exercise</h1>
        
        <div class="user-details">
            <div class="student-info">
                <div>Name: <span id="display-name"></span></div>
                <div>Roll: <span id="display-roll"></span></div>
            </div>
            <div class="student-info">
                <div>Department: <span id="display-department"></span></div>
                <button id="logout-btn" class="logout-btn">Exit Game</button>
            </div>
        </div>
        
        <div class="container">
            <div class="instructions">
                <p><strong>Instructions:</strong> Drag and drop the sentences into the correct order. You can check your answer only once per attempt. You have 1 minute and 30 seconds to complete each exercise.</p>
            </div>
            
            <div class="timer-container" id="timer-container">
                Time remaining: <span id="timer">1:30</span>
            </div>
            
            <div class="examples-row" id="examples-row">
                <!-- Example buttons will be added here -->
            </div>
            
            <div class="current-example" id="current-example">
                Current Example: A Day at the Beach
            </div>
            
            <div class="sentence-container" id="sentences">
                <!-- Sentences will be added here -->
            </div>
            
            <div class="score-display" id="score-display" style="display: none;">
                <div id="points-text">Score: 0/5 points</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%">0%</div>
                </div>
            </div>
            
            <div class="attempt-info" id="attempt-info" style="display: none;">
                You've used your one check for this attempt. Reset or select a new example to try again.
            </div>
            
            <div class="controls">
                <button id="check-btn">Check Answer</button>
                <button id="next-btn" disabled>Next Question</button>
            </div>
            
            <div id="result"></div>
        </div>
    </div>
    
    <!-- Time's Up Modal -->
    <div id="times-up-modal" class="modal-overlay hidden">
        <div class="modal">
            <h3>Time's Up!</h3>
            <p>You've run out of time for this exercise.</p>
            <div class="modal-footer">
                <button id="time-up-ok">OK</button>
            </div>
        </div>
    </div>

    <div id="summary-modal" class="modal-overlay hidden">
        <div class="modal">
            <h3>Exercise Summary</h3>
            <div id="summary-content"></div>
            <div class="modal-footer">
                <button id="summary-ok">OK</button>
            </div>
        </div>
    </div>

    <script>
       // Add this at the beginning of your script section
const script = document.createElement('script');
script.textContent = `
    // Define examples with correct order
    const examples = {
        story1: {
            title: "Job Application",
            sentences: [
                "Excited about the opportunity to contribute to your team",
                "I am with my background in software development and expertise in Python and Java.",
                "For your review, I have attached my resume and cover letter.",
                "I look forward to discussing how my skills align with your requirements.",
                "Thank you for considering my application for the position."
            ],
            completed: false,
            score: 0
        },
        story2: {
            title: "Making a Sandwich",
            sentences: [
                "First, I gathered two slices of bread, cheese, lettuce, and tomato.",
                "Then, I spread mayonnaise on one slice of bread and mustard on the other.",
                "Next, I layered the cheese, lettuce, and tomato between the bread slices.",
                "After that, I cut the sandwich in half diagonally.",
                "Finally, I placed it on a plate and enjoyed my lunch."
            ],
            completed: false,
            score: 0
        },
        story3: {
            title: "Morning Routine",
            sentences: [
                "I wake up at 6 AM every weekday morning.",
                "After brushing my teeth, I do a quick workout for twenty minutes.",
                "Then I take a shower and get dressed for work.",
                "I prepare and eat a healthy breakfast while checking my emails.",
                "Finally, I grab my bag and head out to catch the 7:30 bus."
            ],
            completed: false,
            score: 0
        }
    };

    let currentExample = "story1";
    let correctOrder = [...examples[currentExample].sentences];
    let hasCheckedAnswer = false;
    let currentStudent = null;
    let timerInterval = null;
    let timeRemaining = 90; // 1 minute and 30 seconds
    let allCompleted = false;
    
    // DOM elements
    const studentEntryView = document.getElementById("student-entry-view");
    const appView = document.getElementById("app-view");
    const studentForm = document.getElementById("student-form");
    const displayName = document.getElementById("display-name");
    const displayRoll = document.getElementById("display-roll");
    const displayDepartment = document.getElementById("display-department");
    const logoutBtn = document.getElementById("logout-btn");
    const timesUpModal = document.getElementById("times-up-modal");
    const timeUpOkBtn = document.getElementById("time-up-ok");
    const summaryModal = document.getElementById("summary-modal");
    const summaryOkBtn = document.getElementById("summary-ok");

    const sentencesContainer = document.getElementById("sentences");
    const checkButton = document.getElementById("check-btn");
    const resultDiv = document.getElementById("result");
    const scoreDisplay = document.getElementById("score-display");
    const pointsText = document.getElementById("points-text");
    const progressBar = document.getElementById("progress-bar");
    const attemptInfo = document.getElementById("attempt-info");
    const examplesRow = document.getElementById("examples-row");
    const currentExampleTitle = document.getElementById("current-example");
    const timerContainer = document.getElementById("timer-container");
    const timerSpan = document.getElementById("timer");
    const nextButton = document.getElementById("next-btn");

    // Update the summary display
    function updateSummaryDisplay() {
        const summaryContent = document.getElementById("summary-content");
        summaryContent.innerHTML = "";
        
        let totalScore = 0;
        let totalPossible = 0;
        
        // Create summary table
        const table = document.createElement("table");
        table.className = "summary-table";
        
        // Add header row
        const headerRow = document.createElement("tr");
        const header1 = document.createElement("th");
        header1.textContent = "Exercise";
        const header2 = document.createElement("th");
        header2.textContent = "Score";
        headerRow.appendChild(header1);
        headerRow.appendChild(header2);
        table.appendChild(headerRow);
        
        // Add data rows
        Object.keys(examples).forEach(key => {
            const example = examples[key];
            const row = document.createElement("tr");
            
            const titleCell = document.createElement("td");
            titleCell.textContent = example.title;
            
            const scoreCell = document.createElement("td");
            if (example.completed) {
                scoreCell.textContent = \`\${example.score}/\${example.sentences.length}\`;
                totalScore += example.score;
                totalPossible += example.sentences.length;
            } else {
                scoreCell.textContent = "Not attempted";
            }
            
            row.appendChild(titleCell);
            row.appendChild(scoreCell);
            table.appendChild(row);
        });
        
        // Add total row
        const totalRow = document.createElement("tr");
        totalRow.className = "total-row";
        
        const totalLabelCell = document.createElement("td");
        totalLabelCell.textContent = "Total Score:";
        
        const totalScoreCell = document.createElement("td");
        totalScoreCell.textContent = \`\${totalScore}/\${totalPossible} (\${Math.round((totalScore/totalPossible)*100)}%)\`;
        
        totalRow.appendChild(totalLabelCell);
        totalRow.appendChild(totalScoreCell);
        table.appendChild(totalRow);
        
        // Add table to summary
        summaryContent.appendChild(table);
    }

    // Check if all examples are completed
    function checkAllCompleted() {
        allCompleted = Object.keys(examples).every(key => examples[key].completed);
        
        if (allCompleted) {
            updateSummaryDisplay();
            summaryModal.classList.remove("hidden");
        }
    }

    // Student form submission handler
    studentForm.addEventListener("submit", function(e) {
        e.preventDefault();
        
        const name = document.getElementById("student-name").value;
        const roll = document.getElementById("roll-number").value;
        const department = document.getElementById("department").value;
        
        // Store student information
        currentStudent = {
            name: name,
            roll: roll,
            department: department
        };
        
        // Update UI
        displayName.textContent = name;
        displayRoll.textContent = roll;
        displayDepartment.textContent = department;
        
        // Show app view
        studentEntryView.classList.add("hidden");
        appView.classList.remove("hidden");
        
        // Initialize app
        createExampleButtons();
        loadExample(currentExample);
    });
    
    // Next button handler
    nextButton.addEventListener("click", () => {
        // Get the current example key
        const currentExampleIndex = Object.keys(examples).indexOf(currentExample);
        const exampleKeys = Object.keys(examples);
        
        // Find next unfinished example
        let nextExampleIndex = (currentExampleIndex + 1) % exampleKeys.length;
        let nextExampleKey = exampleKeys[nextExampleIndex];
        
        // If we've gone through all examples, check if all are completed
        if (nextExampleIndex <= currentExampleIndex && Object.keys(examples).every(key => examples[key].completed)) {
            // All examples are completed, show summary
            updateSummaryDisplay();
            summaryModal.classList.remove("hidden");
            return;
        }
        
        // Find the next uncompleted example (if all completed, this won't execute)
        while (examples[nextExampleKey].completed && nextExampleIndex !== currentExampleIndex) {
            nextExampleIndex = (nextExampleIndex + 1) % exampleKeys.length;
            nextExampleKey = exampleKeys[nextExampleIndex];
        }
        
        // Load the next example
        loadExample(nextExampleKey);
        
        // Update active button in examples row
        document.querySelectorAll(".example-btn").forEach(btn => {
            btn.classList.remove("active");
        });
        document.querySelectorAll(".example-btn")[nextExampleIndex].classList.add("active");
    });
    
    // Logout (Exit Game) Handler
    logoutBtn.addEventListener("click", function() {
        // Clear current student
        currentStudent = null;
        
        // Stop timer if running
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        
        // Reset all examples
        Object.keys(examples).forEach(key => {
            examples[key].completed = false;
            examples[key].score = 0;
        });
        
        // Show student entry view
        appView.classList.add("hidden");
        studentEntryView.classList.remove("hidden");
        summaryModal.classList.add("hidden");
        
        // Clear student form
        document.getElementById("student-name").value = "";
        document.getElementById("roll-number").value = "";
        document.getElementById("department").value = "";
    });
    
    // Timer functions
    function startTimer() {
        // Clear any existing timer
        if (timerInterval) {
            clearInterval(timerInterval);
        }
        
        // If example is already completed, don't start timer
        if (examples[currentExample].completed) {
            return;
        }
        
        // Reset time
        timeRemaining = 90; // 1:30 minutes
        updateTimerDisplay();
        
        // Start new timer
        timerInterval = setInterval(function() {
            timeRemaining--;
            updateTimerDisplay();
            
            if (timeRemaining <= 30) {
                timerSpan.classList.add("timer-warning");
            } else {
                timerSpan.classList.remove("timer-warning");
            }
            
            if (timeRemaining <= 0) {
                // Time's up
                clearInterval(timerInterval);
                timesUpModal.classList.remove("hidden");
                
                // Lock the exercise
                hasCheckedAnswer = true;
                checkButton.disabled = true;
                sentencesContainer.classList.add("locked");
                
                // Mark as completed with score 0
                examples[currentExample].completed = true;
                examples[currentExample].score = 0;
                
                // Check if all completed
                checkAllCompleted();
                
                // Enable the next button when time's up
                nextButton.disabled = false;
            }
        }, 1000);
    }
    
    function updateTimerDisplay() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        timerSpan.textContent = \`\${minutes}:\${seconds.toString().padStart(2, '0')}\`;
    }
    
    // Time's up modal handler
    timeUpOkBtn.addEventListener("click", function() {
        timesUpModal.classList.add("hidden");
        attemptInfo.style.display = "block";
        nextButton.disabled = false;  // Enable next button when acknowledging time's up
    });

    // Summary modal handler
    summaryOkBtn.addEventListener("click", function() {
        summaryModal.classList.add("hidden");
    });
    
    // Create example buttons
    function createExampleButtons() {
        examplesRow.innerHTML = "";
        
        Object.keys(examples).forEach((key, index) => {
            const button = document.createElement("button");
            button.classList.add("example-btn");
            if (key === currentExample) {
                button.classList.add("active");
            }
            
            // Add completed indicator to button text if completed
            let buttonText = examples[key].title;
            if (examples[key].completed) {
                buttonText += \` (Score: \${examples[key].score}/\${examples[key].sentences.length})\`;
            }
            button.textContent = buttonText;
            
            button.addEventListener("click", () => {
                if (key !== currentExample) {
                    loadExample(key);
                    
                    // Update active button
                    document.querySelectorAll(".example-btn").forEach(btn => {
                        btn.classList.remove("active");
                    });
                    button.classList.add("active");
                }
            });
            examplesRow.appendChild(button);
        });
    }
    
    // Load selected example
    function loadExample(exampleKey) {
        currentExample = exampleKey;
        correctOrder = [...examples[exampleKey].sentences];
        
        // Check if this example is already completed
        if (examples[exampleKey].completed) {
            hasCheckedAnswer = true;
            
            // Update example title
            currentExampleTitle.textContent = \`\${examples[exampleKey].title} (Completed - Score: \${examples[exampleKey].score}/\${examples[exampleKey].sentences.length})\`;
            
            // Clear current sentences
            sentencesContainer.innerHTML = "";
            sentencesContainer.classList.add("locked");
            
            // Create sentences in correct order
            correctOrder.forEach(sentence => {
                const sentenceElement = document.createElement("div");
                sentenceElement.classList.add("sentence");
                sentenceElement.classList.add("correct");
                sentenceElement.textContent = sentence;
                sentenceElement.draggable = false;
                sentencesContainer.appendChild(sentenceElement);
            });
            
            // Update UI for completed state
            resultDiv.style.display = "block";
            resultDiv.textContent = \`You scored \${examples[exampleKey].score} out of \${examples[exampleKey].sentences.length} on this exercise.\`;
            resultDiv.className = examples[exampleKey].score === examples[exampleKey].sentences.length ? "correct-result" : "partial-result";
            
            scoreDisplay.style.display = "block";
            const scorePercentage = Math.round((examples[exampleKey].score / examples[exampleKey].sentences.length) * 100);
            pointsText.textContent = \`Score: \${examples[exampleKey].score}/\${examples[exampleKey].sentences.length} points\`;
            progressBar.style.width = \`\${scorePercentage}%\`;
            progressBar.textContent = \`\${scorePercentage}%\`;
            
            attemptInfo.style.display = "block";
            attemptInfo.textContent = "You have already completed this exercise.";
            
            checkButton.disabled = true;
            nextButton.disabled = false;
            
            // Don't start timer for completed examples
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            timerContainer.style.display = "none";
            
            return;
        } else {
            // Reset for new uncompleted example
            hasCheckedAnswer = false;
            timerContainer.style.display = "block";
        }
        
        // Update example title
        currentExampleTitle.textContent = \`Current Example: \${examples[exampleKey].title}\`;
        
        // Clear current sentences
        sentencesContainer.innerHTML = "";
        sentencesContainer.classList.remove("locked");
        
        // Create shuffled array
        let shuffled = [...correctOrder];
        shuffleArray(shuffled);
        
        // Add sentences to container
        shuffled.forEach(sentence => {
            const sentenceElement = document.createElement("div");
            sentenceElement.classList.add("sentence");
            sentenceElement.textContent = sentence;
            sentenceElement.draggable = true;
            sentencesContainer.appendChild(sentenceElement);
            
            // Add drag events
            sentenceElement.addEventListener("dragstart", dragStart);
            sentenceElement.addEventListener("dragover", dragOver);
            sentenceElement.addEventListener("dragenter", dragEnter);
            sentenceElement.addEventListener("dragleave", dragLeave);
            sentenceElement.addEventListener("drop", drop);
            sentenceElement.addEventListener("dragend", dragEnd);
        });
        
        // Reset UI elements
        resultDiv.style.display = "none";
        scoreDisplay.style.display = "none";
        attemptInfo.style.display = "none";
        checkButton.disabled = false;
        nextButton.disabled = true;  // Disable next button when loading a new example
        
        // Reset sentence styling
        const allSentences = document.querySelectorAll(".sentence");
        allSentences.forEach(sentence => {
            sentence.classList.remove("correct", "incorrect");
        });
        
        // Start timer for new example
        startTimer();
    }
    
    // Shuffle array (Fisher-Yates algorithm)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    
    // Dragging functionality
    let draggedItem = null;
    
    function dragStart() {
        // Only allow dragging if not locked
        if (sentencesContainer.classList.contains("locked")) {
            event.preventDefault();
            return false;
        }
        draggedItem = this;
        setTimeout(() => this.classList.add("dragging"), 0);
    }
    
    function dragOver(e) {
        e.preventDefault();
    }
    
    function dragEnter(e) {
        e.preventDefault();
    }
    
    function dragLeave() {
    }
    
    function drop() {
        if (this !== draggedItem && !sentencesContainer.classList.contains("locked")) {
            const allSentences = Array.from(sentencesContainer.querySelectorAll(".sentence"));
            const draggedIndex = allSentences.indexOf(draggedItem);
            const dropIndex = allSentences.indexOf(this);
            
            if (draggedIndex < dropIndex) {
                this.parentNode.insertBefore(draggedItem, this.nextSibling);
            } else {
                this.parentNode.insertBefore(draggedItem, this);
            }
        }
    }
    
    function dragEnd() {
        this.classList.remove("dragging");
    }
    
    // Check answer functionality
    checkButton.addEventListener("click", () => {
        if (hasCheckedAnswer || examples[currentExample].completed) return;
        
        const currentSentences = Array.from(sentencesContainer.querySelectorAll(".sentence"));
        const currentTexts = currentSentences.map(el => el.textContent);
        
        let correctCount = 0;
        
        // Check each sentence and mark as correct/incorrect
        currentSentences.forEach((sentenceEl, index) => {
            sentenceEl.classList.remove("correct", "incorrect");
            
            if (currentTexts[index] === correctOrder[index]) {
                sentenceEl.classList.add("correct");
                correctCount++;
            } else {
                sentenceEl.classList.add("incorrect");
            }
        });
        
        // Store the score
        examples[currentExample].completed = true;
        examples[currentExample].score = correctCount;
        
        // Update example buttons to show scores
        createExampleButtons();
        
        // Calculate score percentage
        const totalSentences = correctOrder.length;
        const scorePercentage = Math.round((correctCount / totalSentences) * 100);
        
        // Stop timer
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        
        // Update score display
        scoreDisplay.style.display = "block";
        pointsText.textContent = \`Score: \${correctCount}/\${totalSentences} points\`;
        progressBar.style.width = \`\${scorePercentage}%\`;
        progressBar.textContent = \`\${scorePercentage}%\`;
        
        // Update result message
        resultDiv.style.display = "block";
        
        if (correctCount === totalSentences) {
            resultDiv.textContent = "Perfect! All sentences are in the correct order.";
            resultDiv.className = "correct-result";
        } else if (correctCount > 0) {
            resultDiv.textContent = \`You have \${correctCount} out of \${totalSentences} sentences in the correct position.\`;
            resultDiv.className = "partial-result";
        } else {
            resultDiv.textContent = "None of the sentences are in the correct position.";
            resultDiv.className = "incorrect-result";
        }
        
        // Lock the exercise
        hasCheckedAnswer = true;
        checkButton.disabled = true;
        sentencesContainer.classList.add("locked");
        attemptInfo.style.display = "block";
        
        // Check if all examples are now completed
        checkAllCompleted();
        
        // Enable the next button after checking
        nextButton.disabled = false;
    });
    
    // Summary OK button handler
    if (summaryOkBtn) {
        summaryOkBtn.addEventListener("click", function() {
            summaryModal.classList.add("hidden");
        });
    }
    
    // Initialize by showing the student entry form
    window.onload = function() {
        studentEntryView.classList.remove("hidden");
        appView.classList.add("hidden");
    };
`;

document.body.appendChild(script);
    </script>
</body>
</html>