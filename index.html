<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Reordering Game</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .timer {
            font-size: 1.2rem;
            text-align: center;
            margin: 10px 0;
            color: #e74c3c;
            font-weight: bold;
        }
        
        .situation-title {
            background-color: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .sentences-container {
            min-height: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: #f9f9f9;
            margin-bottom: 20px;
        }
        
        .sentence {
            background-color: #3498db;
            color: white;
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: move;
            user-select: none;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .sentence:hover {
            transform: translateY(-2px);
        }
        
        .sentence.dragging {
            opacity: 0.5;
        }
        
        button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #27ae60;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .result {
            display: none;
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background-color: #e8f4f8;
            border-radius: 5px;
            border: 1px solid #3498db;
        }
        
        .result h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .user-info {
            background-color: #eaf2f8;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .score {
            font-size: 1.8rem;
            color: #27ae60;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .time-taken {
            font-size: 1.2rem;
            color: #e67e22;
            margin-bottom: 15px;
        }
        
        .feedback {
            font-weight: bold;
            margin-top: 15px;
        }
        
        .sentence.correct {
            background-color: #2ecc71;
        }
        
        .sentence.incorrect {
            background-color: #e74c3c;
        }
        
        /* Registration Form Styles */
        #registration-screen {
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .completed-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sentence Reordering Game</h1>
        
        <!-- Already Completed Screen -->
        <div id="completed-screen" style="display: none;">
            <div class="completed-message">
                <h2>You have already completed this exercise</h2>
                <p>This educational exercise is designed to be taken only once per student.</p>
                <div id="completed-user-info" class="user-info"></div>
                <div id="completed-score" class="score"></div>
            </div>
        </div>
        
        <!-- Registration Screen -->
        <div id="registration-screen">
            <div class="instructions">
                <p>Welcome to the Sentence Reordering Game! Please enter your details to begin.</p>
                <p><strong>Note:</strong> You can only attempt this exercise once. Your results will be saved.</p>
            </div>
            
            <form id="registration-form">
                <div class="form-group">
                    <label for="name">Full Name:</label>
                    <input type="text" id="name" name="name" required>
                    <div class="error-message" id="name-error">Please enter your name</div>
                </div>
                
                <div class="form-group">
                    <label for="roll">Roll Number:</label>
                    <input type="text" id="roll" name="roll" required>
                    <div class="error-message" id="roll-error">Please enter your roll number</div>
                </div>
                
                <div class="form-group">
                    <label for="department">Department:</label>
                    <input type="text" id="department" name="department" required>
                    <div class="error-message" id="department-error">Please enter your department</div>
                </div>
                
                <button type="submit" id="start-btn">Start Game</button>
            </form>
        </div>
        
        <!-- Game Screen (initially hidden) -->
        <div id="game-screen" style="display: none;">
            <div class="instructions">
                <p>Drag and drop the sentences to arrange them in the correct order. You have 1:30 minutes for each situation.</p>
                <p>Once you finish a situation, click the "Check Answers" button to see your score.</p>
                <p>You can only attempt each question once. Good luck!</p>
            </div>
            
            <div class="user-info" id="user-info-display">
                <!-- User details will be displayed here -->
            </div>
            
            <div class="timer" id="timer">Time remaining: 1:30</div>
            <div class="situation-title" id="situation-title">Situation 1</div>
            
            <div id="sentences-container" class="sentences-container">
                <!-- Sentences will be dynamically added here -->
            </div>
            
            <button id="check-btn">Check Answers</button>
            <button id="next-btn" style="display: none;">Next Situation</button>
        </div>
        
        <!-- Result Screen (initially hidden) -->
        <div id="result-screen" class="result">
            <h2>Game Complete!</h2>
            
            <div class="user-info" id="result-user-info">
                <!-- User details will be displayed here -->
            </div>
            
            <div class="score" id="final-score">Score: 0/10</div>
            <div class="time-taken" id="time-taken">Time taken: 0 minutes and 0 seconds</div>
            <div class="feedback" id="feedback"></div>
        </div>
    </div>

    <script>
        // Game data
        const situations = [
            {
                title: "Request for Sponsorship",
        sentences: [
            "I am reaching out on behalf of TechX Robotics Club, seeking sponsorship for the upcoming National Robotics Championship 2025.",
            "Our team has consistently excelled in innovation, and your support would help us develop cutting-edge prototypes for the competition.",
            "In return, we can offer brand visibility through banners, event promotions, and social media campaigns.",
            "Please let us know if you would be interested in discussing this opportunity further.",
            "We appreciate your consideration and look forward to the possibility of collaborating with your esteemed organization."
        ],
            },
            {
                title: "Invitation to an Event",
        sentences: [
            "I am excited to invite you to the Tech Conference 2025 on May 5 at The Grand Hall, Mumbai.",
            "The event will provide networking opportunities with industry leaders.",
            "Youâ€™ll get insights into the latest technological innovations.",
            "Please let me know if you will be able to attend.",
            "The presence of yours we look forward to."
        ],
            },

        ];

        // Game variables
        let currentSituation = 0;
        let timeLeft = 90; // 1:30 minutes in seconds
        let timer;
        let scores = [];
        let startTime;
        let totalTime = 0;
        let hasChecked = [];
        let userData = {
            name: "",
            roll: "",
            department: "",
            completed: false,
            totalScore: 0,
            maxScore: 0
        };
        
        // Set up initial scores and checked status arrays
        for (let i = 0; i < situations.length; i++) {
            scores.push(0);
            hasChecked.push(false);
        }
        
        // DOM elements
        const completedScreen = document.getElementById('completed-screen');
        const completedUserInfo = document.getElementById('completed-user-info');
        const completedScore = document.getElementById('completed-score');
        const registrationScreen = document.getElementById('registration-screen');
        const registrationForm = document.getElementById('registration-form');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const timerElement = document.getElementById('timer');
        const situationTitle = document.getElementById('situation-title');
        const sentencesContainer = document.getElementById('sentences-container');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const finalScore = document.getElementById('final-score');
        const timeTaken = document.getElementById('time-taken');
        const feedback = document.getElementById('feedback');
        const userInfoDisplay = document.getElementById('user-info-display');
        const resultUserInfo = document.getElementById('result-user-info');
        
        // Check if the game has already been completed
        checkGameStatus();
        
        // Initialize the registration form
        registrationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate form
            let isValid = true;
            
            const nameInput = document.getElementById('name');
            const rollInput = document.getElementById('roll');
            const departmentInput = document.getElementById('department');
            
            const nameError = document.getElementById('name-error');
            const rollError = document.getElementById('roll-error');
            const departmentError = document.getElementById('department-error');
            
            // Reset error messages
            nameError.style.display = 'none';
            rollError.style.display = 'none';
            departmentError.style.display = 'none';
            
            // Validate name
            if (!nameInput.value.trim()) {
                nameError.style.display = 'block';
                isValid = false;
            }
            
            // Validate roll number
            if (!rollInput.value.trim()) {
                rollError.style.display = 'block';
                isValid = false;
            }
            
            // Validate department
            if (!departmentInput.value.trim()) {
                departmentError.style.display = 'block';
                isValid = false;
            }
            
            if (isValid) {
                // Store user data
                userData.name = nameInput.value.trim();
                userData.roll = rollInput.value.trim();
                userData.department = departmentInput.value.trim();
                
                // Save initial user data to localStorage
                saveGameState();
                
                // Display user info
                displayUserInfo();
                
                // Hide registration screen, show game screen
                registrationScreen.style.display = 'none';
                gameScreen.style.display = 'block';
                
                // Start the game
                initGame();
            }
        });
        
        // Check if the game has already been completed
        function checkGameStatus() {
            // Try to load saved game state
            const savedData = localStorage.getItem('sentenceGame_' + getUniqueIdentifier());
            
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                
                // If the game was completed, show completed screen
                if (parsedData.completed) {
                    userData = parsedData;
                    
                    // Display user info on completed screen
                    const userInfoHTML = `
                        <strong>Name:</strong> ${userData.name} | 
                        <strong>Roll Number:</strong> ${userData.roll} | 
                        <strong>Department:</strong> ${userData.department}
                    `;
                    
                    completedUserInfo.innerHTML = userInfoHTML;
                    completedScore.textContent = `Your Score: ${userData.totalScore}/${userData.maxScore}`;
                    
                    // Show completed screen, hide others
                    completedScreen.style.display = 'block';
                    registrationScreen.style.display = 'none';
                    gameScreen.style.display = 'none';
                    resultScreen.style.display = 'none';
                }
            }
        }
        
        // Generate a unique identifier based on user data
        function getUniqueIdentifier() {
            if (userData.roll) {
                return userData.roll.toLowerCase().replace(/\s+/g, '');
            } else {
                return 'defaultUser';
            }
        }
        
        // Save game state to localStorage
        function saveGameState() {
            localStorage.setItem('sentenceGame_' + getUniqueIdentifier(), JSON.stringify(userData));
        }
        
        // Display user information
        function displayUserInfo() {
            const userInfoHTML = `
                <strong>Name:</strong> ${userData.name} | 
                <strong>Roll Number:</strong> ${userData.roll} | 
                <strong>Department:</strong> ${userData.department}
            `;
            
            userInfoDisplay.innerHTML = userInfoHTML;
            resultUserInfo.innerHTML = userInfoHTML;
        }
        
        // Initialize the game
        function initGame() {
            startTime = new Date();
            loadSituation(currentSituation);
            startTimer();
            
            checkBtn.addEventListener('click', checkAnswers);
            nextBtn.addEventListener('click', nextSituation);
        }
        
        // Load a situation
        function loadSituation(index) {
            situationTitle.textContent = `Situation ${index + 1}: ${situations[index].title}`;
            sentencesContainer.innerHTML = '';
            
            // Shuffle sentences and add them to the container
            const shuffledSentences = [...situations[index].sentences].sort(() => Math.random() - 0.5);
            
            shuffledSentences.forEach((sentence, sentenceIndex) => {
                const sentenceElement = document.createElement('div');
                sentenceElement.className = 'sentence';
                sentenceElement.textContent = sentence;
                sentenceElement.dataset.correctIndex = situations[index].sentences.indexOf(sentence);
                sentenceElement.dataset.currentIndex = sentenceIndex;
                sentenceElement.draggable = true;
                
                sentenceElement.addEventListener('dragstart', dragStart);
                sentenceElement.addEventListener('dragend', dragEnd);
                
                sentencesContainer.appendChild(sentenceElement);
            });
            
            // Add event listeners for drag and drop
            sentencesContainer.addEventListener('dragover', dragOver);
            sentencesContainer.addEventListener('drop', drop);
        }
        
        // Start the timer
        function startTimer() {
            timeLeft = 90; // Reset to 1:30
            updateTimerDisplay();
            
            clearInterval(timer); // Clear any existing timer
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    checkAnswers();
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `Time remaining: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            if (timeLeft <= 10) {
                timerElement.style.color = '#e74c3c'; // Red for last 10 seconds
            } else {
                timerElement.style.color = '#2c3e50'; // Normal color
            }
        }
        
        // Drag and drop functionality
        let draggedSentence = null;
        
        function dragStart(e) {
            draggedSentence = this;
            this.classList.add('dragging');
            
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.dataset.correctIndex);
        }
        
        function dragEnd(e) {
            this.classList.remove('dragging');
            draggedSentence = null;
        }
        
        function dragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            // Find the target sentence
            const targetSentence = e.target.closest('.sentence');
            if (!targetSentence || targetSentence === draggedSentence) return;
            
            // Get all sentences
            const sentences = Array.from(sentencesContainer.querySelectorAll('.sentence'));
            const draggedIndex = sentences.indexOf(draggedSentence);
            const targetIndex = sentences.indexOf(targetSentence);
            
            // Determine if we're moving up or down
            if (draggedIndex < targetIndex) {
                sentencesContainer.insertBefore(draggedSentence, targetSentence.nextSibling);
            } else {
                sentencesContainer.insertBefore(draggedSentence, targetSentence);
            }
        }
        
        function drop(e) {
            e.preventDefault();
            // The actual reordering is done in dragOver
        }
        
        // Check answers
        function checkAnswers() {
            clearInterval(timer);
            
            if (hasChecked[currentSituation]) return;
            
            // Calculate score for current situation
            const sentences = Array.from(sentencesContainer.querySelectorAll('.sentence'));
            let correctCount = 0;
            
            sentences.forEach((sentence, index) => {
                const correctIndex = parseInt(sentence.dataset.correctIndex);
                
                if (correctIndex === index) {
                    correctCount++;
                    sentence.classList.add('correct');
                } else {
                    sentence.classList.add('incorrect');
                }
                
                // Disable dragging
                sentence.draggable = false;
            });
            
            scores[currentSituation] = correctCount;
            hasChecked[currentSituation] = true;
            
            // Save progress
            saveGameState();
            
            // Show next button or results
            checkBtn.style.display = 'none';
            
            if (currentSituation < situations.length - 1) {
                nextBtn.style.display = 'inline-block';
            } else {
                showResults();
            }
        }
        
        // Move to next situation
        function nextSituation() {
            currentSituation++;
            
            if (currentSituation < situations.length) {
                loadSituation(currentSituation);
                startTimer();
                checkBtn.style.display = 'inline-block';
                nextBtn.style.display = 'none';
            } else {
                showResults();
            }
        }
        
        // Show final results
        function showResults() {
            // Calculate total time taken
            const endTime = new Date();
            totalTime = Math.floor((endTime - startTime) / 1000); // in seconds
            
            // Calculate total score
            const totalScore = scores.reduce((sum, score) => sum + score, 0);
            const maxScore = situations.reduce((sum, situation) => sum + situation.sentences.length, 0);
            
            // Update user data
            userData.completed = true;
            userData.totalScore = totalScore;
            userData.maxScore = maxScore;
            
            // Save final results
            saveGameState();
            
            // Display results
            finalScore.textContent = `Score: ${totalScore}/${maxScore}`;
            
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            timeTaken.textContent = `Time taken: ${minutes} minute${minutes !== 1 ? 's' : ''} and ${seconds} second${seconds !== 1 ? 's' : ''}`;
            
            // Add feedback based on score
            let feedbackText;
            const scorePercentage = (totalScore / maxScore) * 100;
            
            if (scorePercentage >= 90) {
                feedbackText = "Excellent! You have a great understanding of logical sentence order!";
            } else if (scorePercentage >= 70) {
                feedbackText = "Good job! You have a solid grasp of logical sentence ordering.";
            } else if (scorePercentage >= 50) {
                feedbackText = "Not bad! Keep practicing to improve your sentence ordering skills.";
            } else {
                feedbackText = "Keep practicing! Logical ordering takes time to master.";
            }
            
            feedback.textContent = feedbackText;
            
            // Show result screen, hide game screen
            gameScreen.style.display = 'none';
            resultScreen.style.display = 'block';
        }
        
        // Handle page refresh/reload
        window.addEventListener('beforeunload', function() {
            // If game is in progress but not completed, save current state
            if (!userData.completed && userData.name) {
                saveGameState();
            }
        });
    </script>
</body>
</html>