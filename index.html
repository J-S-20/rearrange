<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Reordering Game</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #f72585;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            color: #666;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .sentence-list {
            list-style-type: none;
            margin-bottom: 20px;
        }
        
        .sentence-item {
            background-color: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 2px solid #eee;
            cursor: move;
            transition: all 0.2s;
        }
        
        .sentence-item:hover {
            background-color: #e9ecef;
            border-color: var(--primary-color);
        }
        
        .sentence-item.dragging {
            opacity: 0.5;
            border: 2px dashed var(--primary-color);
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }
        
        .instructions h3 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin: 0 5px;
            font-weight: bold;
        }
        
        .step.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .step.completed {
            background-color: var(--success-color);
            color: white;
        }
        
        .feedback {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .success {
            color: var(--success-color);
        }
        
        .warning {
            color: var(--warning-color);
        }
        
        .error {
            color: var(--error-color);
        }
        
        .results {
            text-align: center;
        }
        
        .results-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .score {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        
        .score-value {
            font-weight: bold;
            font-size: 2rem;
            color: var(--primary-color);
        }
        
        .feedback-message {
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sentence Reordering Game</h1>
            <p>Arrange sentences in logical order to improve your comprehension skills</p>
        </div>
        
        <div id="registration-section" class="card">
            <h2 class="section-title">Student Registration</h2>
            <form id="registration-form">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="roll">Roll Number</label>
                    <input type="text" id="roll" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="department">Department</label>
                    <select id="department" class="form-control" required>
                        <option value="">Select Department</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Physics">Physics</option>
                        <option value="Biology">Biology</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Literature">Literature</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-block">Start Game</button>
            </form>
        </div>
        
        <div id="game-section" class="hidden">
            <div class="progress-indicator">
                <div class="step active" id="situation-1-step">Situation 1</div>
                <div class="step" id="situation-2-step">Situation 2</div>
                <div class="step" id="results-step">Results</div>
            </div>
            
            <div class="card">
                <div class="timer" id="timer">Time Remaining: 01:30</div>
                
                <div class="instructions">
                    <h3>Instructions:</h3>
                    <p>Drag and drop the sentences to arrange them in a logical order. You have 1:30 minutes to complete each situation.</p>
                </div>
                
                <h2 class="section-title" id="situation-title">Situation 1: The Scientific Method</h2>
                
                <ul class="sentence-list" id="sentence-list"></ul>
                
                <button id="submit-btn" class="btn btn-block">Submit Answers</button>
            </div>
        </div>
        
        <div id="results-section" class="hidden">
            <div class="card results">
                <h2 class="results-title">Assessment Results</h2>
                
                <div class="score">
                    Your Score: <span class="score-value" id="final-score"></span>
                </div>
                
                <div class="feedback-message" id="feedback-message"></div>
                
                <div>
                    <p>Time Taken: <span id="total-time"></span></p>
                    <p>Completed on: <span id="completion-date"></span></p>
                </div>
                
                <div style="margin-top: 30px;">
                    <p>Your assessment has been saved. You cannot retake this assessment.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
    apiKey: "AIzaSyDXf5DooFzNB24KzvupGiL2iL8WvhcWE8Y",
    authDomain: "mail-reordering-game.firebaseapp.com",
    projectId: "mail-reordering-game",
    storageBucket: "mail-reordering-game.firebasestorage.app",
    messagingSenderId: "509000994429",
    appId: "1:509000994429:web:6159aed7e6b67fd2feab14",
    measurementId: "G-H2NTTPRWR6"
  };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Game Variables
        const situations = [
            {
                id: 1,
                title: "Situation 1: The Scientific Method",
                sentences: [
                    "Scientists begin by making observations about the natural world.",
                    "Based on observations, they formulate a hypothesis - a testable explanation.",
                    "Experiments are designed and conducted to test the hypothesis.",
                    "Data is collected and analyzed to determine if it supports the hypothesis.",
                    "Conclusions are drawn, and the hypothesis is either supported, modified, or rejected."
                ],
                correctOrder: [0, 1, 2, 3, 4]
            },
            {
                id: 2,
                title: "Situation 2: The Water Cycle",
                sentences: [
                    "Water from oceans, lakes, and rivers evaporates due to the sun's heat.",
                    "The water vapor rises into the atmosphere and cools, forming clouds through condensation.",
                    "When the water droplets in clouds become heavy enough, they fall as precipitation.",
                    "Rain and melted snow flow back into bodies of water or seep into the ground.",
                    "Groundwater eventually returns to oceans, completing the cycle."
                ],
                correctOrder: [0, 1, 2, 3, 4]
            }
        ];
        
        let currentStudent = {
            name: "",
            roll: "",
            department: "",
            startTime: null,
            totalTimeTaken: 0,
            situationResults: [],
            overallScore: 0
        };
        
        let currentSituation = 0;
        let timerInterval;
        let timeRemaining = 90; // 1:30 minutes in seconds
        let draggedItem = null;
        
        // Elements
        const registrationSection = document.getElementById("registration-section");
        const gameSection = document.getElementById("game-section");
        const resultsSection = document.getElementById("results-section");
        const registrationForm = document.getElementById("registration-form");
        const sentenceList = document.getElementById("sentence-list");
        const situationTitle = document.getElementById("situation-title");
        const timerElement = document.getElementById("timer");
        const submitBtn = document.getElementById("submit-btn");
        
        // Event Listeners
        registrationForm.addEventListener("submit", handleRegistration);
        submitBtn.addEventListener("submit", checkAndContinue);
        submitBtn.addEventListener("click", checkAndContinue);
        
        // Check if student has already completed the game
        async function checkStudentExists(roll) {
            try {
                const studentRef = db.collection("students").doc(roll);
                const doc = await studentRef.get();
                return doc.exists;
            } catch (error) {
                console.error("Error checking student:", error);
                return false;
            }
        }
        
        // Handle Registration
        async function handleRegistration(e) {
            e.preventDefault();
            
            const name = document.getElementById("name").value.trim();
            const roll = document.getElementById("roll").value.trim();
            const department = document.getElementById("department").value;
            
            if (!name || !roll || !department) {
                alert("Please fill in all fields");
                return;
            }
            
            // Check if student has already taken the assessment
            const exists = await checkStudentExists(roll);
            if (exists) {
                alert("You have already completed this assessment and cannot retake it.");
                return;
            }
            
            // Save student information
            currentStudent.name = name;
            currentStudent.roll = roll;
            currentStudent.department = department;
            currentStudent.startTime = new Date();
            
            // Start game
            registrationSection.classList.add("hidden");
            gameSection.classList.remove("hidden");
            
            // Load first situation
            loadSituation(0);
            startTimer();
        }
        
        // Load Situation
        function loadSituation(index) {
            currentSituation = index;
            
            // Update progress indicator
            document.querySelectorAll(".step").forEach(step => step.classList.remove("active"));
            if (index === 0) {
                document.getElementById("situation-1-step").classList.add("active");
            } else if (index === 1) {
                document.getElementById("situation-1-step").classList.add("completed");
                document.getElementById("situation-2-step").classList.add("active");
            }
            
            // Reset timer
            timeRemaining = 90;
            updateTimerDisplay();
            
            // Set situation title
            situationTitle.textContent = situations[index].title;
            
            // Clear sentence list
            sentenceList.innerHTML = "";
            
            // Shuffle sentences
            const shuffledSentences = [...situations[index].sentences];
            shuffleArray(shuffledSentences);
            
            // Add sentences to list
            shuffledSentences.forEach((sentence, i) => {
                const li = document.createElement("li");
                li.className = "sentence-item";
                li.textContent = sentence;
                li.draggable = true;
                li.dataset.index = situations[index].sentences.indexOf(sentence);
                
                // Add drag event listeners
                li.addEventListener("dragstart", dragStart);
                li.addEventListener("dragover", dragOver);
                li.addEventListener("drop", drop);
                li.addEventListener("dragenter", dragEnter);
                li.addEventListener("dragleave", dragLeave);
                li.addEventListener("dragend", dragEnd);
                
                sentenceList.appendChild(li);
            });
        }
        
        // Timer Functions
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    checkAndContinue();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerElement.textContent = `Time Remaining: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeRemaining <= 15) {
                timerElement.classList.add("error");
            } else {
                timerElement.classList.remove("error");
            }
        }
        
        // Drag and Drop Functions
        function dragStart() {
            draggedItem = this;
            setTimeout(() => this.classList.add("dragging"), 0);
        }
        
        function dragEnd() {
            this.classList.remove("dragging");
            draggedItem = null;
        }
        
        function dragOver(e) {
            e.preventDefault();
        }
        
        function dragEnter(e) {
            e.preventDefault();
            this.classList.add("hovered");
        }
        
        function dragLeave() {
            this.classList.remove("hovered");
        }
        
        function drop() {
            this.classList.remove("hovered");
            if (draggedItem !== this) {
                const allItems = Array.from(sentenceList.querySelectorAll(".sentence-item"));
                const draggedIndex = allItems.indexOf(draggedItem);
                const targetIndex = allItems.indexOf(this);
                
                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(draggedItem, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedItem, this);
                }
            }
        }
        
        // Check Answers and Continue
        function checkAndContinue() {
            clearInterval(timerInterval);
            
            // Calculate score for current situation
            const userOrder = Array.from(sentenceList.querySelectorAll(".sentence-item"))
                .map(item => parseInt(item.dataset.index));
            
            const correctOrder = situations[currentSituation].correctOrder;
            let score = 0;
            let correctCount = 0;
            
            for (let i = 0; i < userOrder.length; i++) {
                if (userOrder[i] === correctOrder[i]) {
                    correctCount++;
                }
            }
            
            score = Math.floor((correctCount / userOrder.length) * 100);
            
            // Save result for current situation
            currentStudent.situationResults.push({
                situation: currentSituation + 1,
                score: score,
                timeTaken: 90 - timeRemaining,
                userOrder: userOrder,
                correctOrder: correctOrder
            });
            
            // Update total time taken
            currentStudent.totalTimeTaken += (90 - timeRemaining);
            
            // Move to next situation or results
            if (currentSituation < situations.length - 1) {
                currentSituation++;
                loadSituation(currentSituation);
                startTimer();
            } else {
                showResults();
            }
        }
        
        // Show Results
        async function showResults() {
            // Calculate overall score
            let totalScore = 0;
            currentStudent.situationResults.forEach(result => {
                totalScore += result.score;
            });
            
            currentStudent.overallScore = Math.floor(totalScore / situations.length);
            
            // Update UI
            gameSection.classList.add("hidden");
            resultsSection.classList.remove("hidden");
            document.getElementById("situation-2-step").classList.add("completed");
            document.getElementById("results-step").classList.add("active");
            
            document.getElementById("final-score").textContent = `${currentStudent.overallScore}%`;
            
            // Set feedback message
            const feedbackMessage = document.getElementById("feedback-message");
            if (currentStudent.overallScore >= 90) {
                feedbackMessage.textContent = "Excellent! You have a strong understanding of logical sentence ordering.";
                feedbackMessage.classList.add("success");
            } else if (currentStudent.overallScore >= 70) {
                feedbackMessage.textContent = "Good job! You have a solid grasp of sentence ordering with some room for improvement.";
                feedbackMessage.classList.add("success");
            } else if (currentStudent.overallScore >= 50) {
                feedbackMessage.textContent = "Fair effort. You understand the basics but should practice more to improve your skills.";
                feedbackMessage.classList.add("warning");
            } else {
                feedbackMessage.textContent = "You need more practice with logical sentence ordering. Focus on identifying sequence markers and context clues.";
                feedbackMessage.classList.add("error");
            }
            
            // Set time and date
            const minutes = Math.floor(currentStudent.totalTimeTaken / 60);
            const seconds = currentStudent.totalTimeTaken % 60;
            document.getElementById("total-time").textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById("completion-date").textContent = new Date().toLocaleString();
            
            // Save to Firebase
            try {
                await saveResults();
            } catch (error) {
                console.error("Error saving results:", error);
            }
        }
        
        // Save Results to Firebase
        async function saveResults() {
            try {
                const studentData = {
                    name: currentStudent.name,
                    roll: currentStudent.roll,
                    department: currentStudent.department,
                    startTime: firebase.firestore.Timestamp.fromDate(currentStudent.startTime),
                    completionTime: firebase.firestore.Timestamp.fromDate(new Date()),
                    totalTimeTaken: currentStudent.totalTimeTaken,
                    overallScore: currentStudent.overallScore,
                    situationResults: currentStudent.situationResults,
                    completedAt: new Date().toISOString()
                };
                
                // Use roll number as document ID to prevent duplicates
                await db.collection("students").doc(currentStudent.roll).set(studentData);
                console.log("Results saved successfully");
            } catch (error) {
                console.error("Error saving results:", error);
                throw error;
            }
        }
        
        // Utility Functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>